# 변경 로그

이 파일은 KRW Momentum Radar 프로젝트의 모든 중요한 변경사항을 기록합니다.

형식은 [Keep a Changelog](https://keepachangelog.com/ko/1.0.0/)를 따르며,
이 프로젝트는 [Semantic Versioning](https://semver.org/lang/ko/)을 준수합니다.

## [Unreleased]

### 추가 예정

- 더 많은 국가 시장 지원
- 실시간 알림 기능
- 백테스팅 모듈

## [3.0.8] - 2025-09-29

### 수정

- **치명적 변동성 필터 로직 개선**: True Range 기반 계산으로 가격 갭 반영
  - 기존: `(당일 고가 - 당일 저가) / 전일 종가` (일중 변동성만 측정)
  - 신규: `max(고가-저가, |고가-전일종가|, |저가-전일종가|) / 전일종가` (가격 갭 포함)
  - 주말/휴일 등 비거래일에 발생하는 큰 폭의 가격 변동(갭 상승/하락) 정확 감지
  - 업계 표준 True Range 방식 적용으로 필터링 정확도 대폭 향상

### 개선

- **거래 적합성 필터 정확도**: 가격 갭을 포함한 실제 변동폭 측정으로 예측 불가능한 변동성 종목 효과적 필터링
- **FMS 랭킹 신뢰도**: 더 정확한 거래 적합성 평가로 사용자에게 신뢰할 수 있는 모멘텀 분석 제공

### 변경

- **True Range 계산**: `calculate_tradeability_filters` 함수에서 True Range 기반 변동성 계산 로직으로 전환
- **필터링 지표**: `일일 변동폭` → `일일 트루 레인지 변동폭`으로 지표명 변경 (내부 로직)

## [3.0.7] - 2025-09-24

### 추가

- **거래 적합성 필터**: FMS 계산에 거래 적합성 실격 필터 추가
  - 치명적 변동성 필터: 63거래일 내 일일 변동폭 15% 초과 시 실격 (FMS = -999)
  - 반복적 하방리스크 필터: 20거래일 내 하방리스크 -7% 미만 4일 이상 시 실격 (FMS = -999)
- **동적 컬럼 재정렬**: FMS 전략에 맞춰 결과 테이블 컬럼 순서 자동 조정
  - 순서: Symbol → FMS → FMS 공식 변수들 → 기타 보조 변수들
- **OHLC 데이터 다운로드**: 거래 적합성 필터를 위한 High, Low, Close 데이터 추가 다운로드

### 개선

- **FMS 설명 업데이트**: UI 도구 및 도움말과 README.md의 FMS 설명을 최신 버전으로 업데이트
- **거래 적합성 필터 통합**: UI 옵션 없이 핵심 로직에 자동 적용
- **디버깅 로그**: 거래 적합성 실격 사유 상세 로깅

## [3.0.6] - 2025-09-20

### 수정

- **FMS 계산 로직 일관성 개선**: Z-score 정규화 기준을 관심종목 집합으로 통일
- **참조 데이터 시스템 도입**: `reference_prices_krw` 매개변수로 Z-score 계산 기준 지정
- **유니버스 스캔 개선**: 관심종목을 참조 데이터로 사용하여 일관된 FMS 값 계산
- **하위 호환성 보장**: 기존 코드 수정 없이 새로운 기능 추가

### 개선

- **신뢰성 향상**: 유니버스 스캔과 관심종목에서 동일한 FMS 값 보장
- **사용자 경험**: FMS 값 불일치 문제 해결로 신뢰성 증대
- **코드 정리**: 사용하지 않는 함수 제거 (`rolling_max`, `log_slope_annualized`)

### 변경

- **FMS 계산 아키텍처**: 참조 데이터 기반 Z-score 계산 시스템으로 전환
- **유니버스 스캔 로직**: 관심종목 데이터를 참조하여 일관된 FMS 계산

## [3.0.5] - 2025-09-19

### 수정

- **FMS 전략 단일화**: Standard 전략 제거, Stable Growth 전략을 FMS로 통일
- **FMS 계산 로직 일관성**: 스캔 결과와 관심종목 표시에서 동일한 FMS 값 계산
- **UI 단순화**: FMS 전략 선택 UI 제거, 도구 및 도움말에만 수식 설명 표시
- **페이징 버튼 중복 방지**: 연속 클릭 시 화살표 버튼 중복 생성 버그 수정
- **캐시 초기화 메시지 개선**: 불필요한 "Rerun 클릭" 메시지 제거

### 개선

- **코드 정리**: 사용하지 않는 strategy 파라미터 및 관련 로직 제거
- **버튼 키 안정화**: 페이징 및 종목 추가 버튼의 고유 키 생성 개선
- **사용자 경험**: 일관된 FMS 계산으로 신뢰성 향상

## [3.0.4] - 2025-09-15

### 추가

- **신규 FMS 전략 '안정 성장형(Stable Growth)' 추가**: 추세의 지속성과 안정성을 중시하는 새로운 FMS 계산 방식
- **3M수익률 지표**: 3개월(63거래일) 수익률을 통한 중기 모멘텀 평가
- **변동성 가속도 지표**: (20일 표준편차) / (120일 표준편차)로 급등 패턴 감지
- **FMS 전략 선택 UI**: 좌측 사이드바에서 Standard/Stable Growth 전략 선택 가능
- **config.py 설정 파일**: FMS 전략 정의 및 관리를 위한 별도 설정 파일

### 개선

- **이벤트성 급등주 필터링**: 변동성 가속도로 수직 폭등 종목 자동 제거
- **안정적 추세 종목 발굴**: 꾸준하고 지속 가능한 상승 추세 종목 우선 표시
- **전략별 UI 동적 표시**: 선택된 전략에 따라 다른 지표 및 설명 표시
- **변동성 제어 강화**: Stable Growth 전략에서 변동성 페널티 4배 강화

### 변경

- **FMS 계산 로직**: 전략별로 다른 가중치 및 지표 조합 사용
- **UI 표시 로직**: 전략에 따라 다른 컬럼 및 배지 표시
- **모든 계산 함수**: 전략 파라미터 지원으로 유연한 FMS 계산

## [3.0.3] - 2025-09-13

### 개선

- **UI/UX 개선**: 페이징 컨트롤을 세로 배치에서 가로 배치로 변경 (⬅️➡️ 버튼 양쪽 끝 배치)
- **사용자 경험**: 관심종목 추가 시 불필요한 성공/경고 메시지 제거로 깔끔한 UI 제공
- **페이징 안전성**: 종목 추가 후 페이징이 깨지지 않도록 안전장치 추가
- **유니버스 신선도 체크**: Streamlit 웨이크업 시 파일 타임스탬프 변경 문제 해결 (별도 타임스탬프 파일 사용)
- **재평가 UI 개선**: 재평가 후 제거 제안 종목에서 휴지통 버튼 클릭 시 목록에서 즉시 제거
- **버튼 비활성화**: 오래 걸리는 작업 실행 중 관련 버튼들 자동 비활성화로 중복 실행 방지
- **상태 표시**: 작업 진행 중 버튼 텍스트 변경으로 현재 상태 명확히 표시
- **유니버스 스크리닝 고도화**: 추세 품질 중심 필터링으로 노이즈 종목 제거 및 안정적 모멘텀 종목 선별
- **워치리스트 초기값 업데이트**: 더 균형잡힌 글로벌 포트폴리오로 초기 관심종목 목록 개선
- **스캔 완료 후 UI 정리**: FMS 스캔 완료 시 스캔 중단 버튼이 자동으로 사라지도록 개선
- **스캔 상태 표시 개선**: 스캔 완료/중지 시 "스캔 중..." 표시가 정확히 사라지도록 개선

### 수정

- **페이징 컨트롤**: 3개 컬럼 구조에서 2개 버튼 양쪽 끝 배치로 변경
- **메시지 정리**: 관심종목 추가/중복 관련 메시지 제거
- **변수명 개선**: col1, col2, col3 → prev_col, spacer_col, next_col, info_col, button_col로 명확화
- **에러 처리**: print 문을 주석으로 변경하여 콘솔 출력 정리
- **재평가 결과**: 종목 제거 시 재평가 결과에서도 동시에 제거하여 데이터 동기화
- **버튼 상태 관리**: 공통 함수 `get_button_states()`로 일관된 상태 관리
- **유니버스 필터링 로직**: 단순 단기 성과 중심에서 추세 품질 중심으로 전환
- **기본 관심종목 목록**: 더 균형잡힌 글로벌 포트폴리오로 교체 (미국 50개, 한국 2개, 일본 1개)
- **스캔 상태 관리**: 스캔 완료 후 scan_progress 세션 상태 자동 초기화
- **스캔 중단 버튼**: 스캔 완료 시 자동으로 숨김 처리
- **스캔 상태 판단 로직**: completed_batches < total_batches 조건 추가로 정확한 스캔 상태 판단

### 변경

- **아키텍처**: 유니버스 파일 신선도 체크를 파일 타임스탬프에서 별도 타임스탬프 파일로 변경
- **UI 레이아웃**: 페이징 버튼을 한 줄에 양쪽 끝 배치로 직관적 개선
- **버튼 관리**: 스캔 중/재평가 중 상태에 따른 통합된 버튼 비활성화 시스템
- **유니버스 스크리닝 전략**:
  - 유동성 기준 강화: 가격 $5→$10, 거래량 200K→300K
  - 추세 지속성 필터 신규 도입: 분기 10% 이상, 반기 20% 이상 상승
  - 추세 안정성 필터 신규 도입: 50일/200일 이동평균 위 종목만 선별
- **기본 관심종목 구성**:
  - 미국: 50개 (주요 개별주 + 섹터 ETF + 글로벌 ETF)
  - 한국: 2개 (SK하이닉스, 삼성전자)
  - 일본: 1개 (토요타자동차)

## [3.0.2] - 2025-09-12

### 추가

- **FMS 스캔 결과 영구 저장**: `scan_results_YYYYMMDD_HHMMSS.csv` 파일로 스캔 결과 자동 저장
- **동적 후보 리스트 관리**: 종목 추가 시 후순위 종목이 자동으로 후보로 올라오는 기능
- **페이징 시스템**: 10개 제한 해제, 5~30개 선택 가능한 페이징 처리
- **FMS 임계값 필터링**: FMS 2.0 이상 종목만 후보로 표시하는 슬라이더 추가
- **저장된 결과 로드**: 이전 스캔 결과를 언제든지 불러올 수 있는 기능

### 개선

- **UI 리로드 문제 해결**: 종목 추가 시 스캔 결과가 사라지지 않도록 개선
- **Finviz 진행률 표시**: 콘솔에서 실제 진행률 확인 방법 안내 메시지 추가
- **사용자 경험**: 명확한 상태 메시지와 색상 코딩으로 FMS 점수 시각화
- **성능 최적화**: 불필요한 `st.rerun()` 호출 최소화

### 수정

- **스캔 결과 지속성**: 세션 종료 후에도 스캔 결과 유지
- **동적 업데이트**: 종목 추가 시 실시간 후보 리스트 업데이트
- **에러 처리**: 강화된 예외 처리 및 사용자 친화적 메시지

### 변경

- **아키텍처**: 스캔 결과 관리 로직을 `universe_utils.py`로 분리
- **UI/UX**: 페이징 컨트롤과 동적 후보 관리로 사용자 경험 대폭 개선
- **데이터 관리**: FMS 2.0 이상 종목만 저장하여 효율성 향상

## [3.0.1] - 2025-09-10

### 수정

- **유니버스 스캔 결과 정렬**: FMS 순으로 정렬되지 않던 문제 수정
- **버전 일관성**: UI에서 v2.9.1로 표시되던 것을 v3.0으로 통일

## [3.0.0] - 2025-09-10

### 추가

- **모듈화된 유니버스 관리**: `universe_utils.py`로 유니버스 관리 로직 분리
- **실시간 진행률 표시**: 유니버스 업데이트 및 FMS 스캔 과정의 실시간 진행률 표시
- **유니버스 파일 업로드**: CSV 파일을 통한 유니버스 교체 기능 복구
- **진행률 콜백 시스템**: `progress_callback`과 `status_callback`으로 UI 업데이트 최적화

### 개선

- **중복 표시 제거**: 진행률 표시의 중복 문제 해결
- **성능 최적화**: 유니버스 업데이트 과정의 불필요한 대기 시간 제거
- **사용자 경험**: 명확한 진행 상황 표시로 사용자 피드백 개선
- **코드 정리**: 사용하지 않는 코드 제거 및 모듈화 강화

### 변경

- **아키텍처**: 유니버스 관리 로직을 별도 모듈로 분리
- **UI 개선**: 진행률 표시 방식 개선 및 중복 제거
- **파일 구조**: `update_universe.py` 제거, `universe_utils.py` 추가

### 제거

- **로컬 실행 스크립트**: `update_universe.py` 파일 제거
- **중복 코드**: 사용하지 않는 함수 및 변수 제거

## [2.9.2] - 2025-09-10

### 추가

- **관심종목 파일 관리**: CSV 파일 업로드/다운로드 기능
- **유니버스 파일 관리**: 스크린된 유니버스 파일 업로드 기능
- **수동 종목 관리**: 개별 종목 추가/삭제 기능
- **FMS 기반 재평가**: 저성과 종목 자동 식별 및 제거 제안

### 개선

- **UI/UX 대폭 개선**: 좌측 메뉴 계층적 구조로 재구성
- **코드 통일성**: 관심종목 관리 기능을 watchlist_utils.py로 통합
- **에러 처리 강화**: 사용자 친화적인 에러 메시지 및 처리
- **무한루프 방지**: 파일 업로드 시 세션 상태 플래그로 중복 실행 방지

### 수정

- **파일 업데이트**: 관심종목 업로드 시 실제 watchlist.csv 파일 업데이트
- **캐시 무효화**: 관심종목 변경 시 우측 메인 영역 자동 새로고침
- **메뉴 정리**: 중복 타이틀 제거 및 기능별 논리적 그룹핑

## [2.9.1] - 2025-01-03

### 추가

- **레버리지/인버스 ETF 제외 필터링**: 모멘텀의 본질을 흐리는 레버리지형 ETF 자동 제외
- **다양한 레버리지 패턴 인식**: 2X, 3X, 2배, 3배, Inverse, Short, Bear 등 다양한 패턴 지원
- **한국어 레버리지 패턴**: 2배, 3배, 2X배, 3X배 등 한국어 패턴도 인식

### 개선

- **모멘텀 분석 정확도**: 레버리지/인버스 ETF 제외로 순수한 모멘텀 분석 가능
- **스크리닝 품질**: 진정한 의미의 모멘텀 종목만 선별하여 분석 품질 향상
- **사용자 경험**: 모멘텀의 본질을 흐리는 종목들이 자동으로 제외되어 더 정확한 분석 제공

### 변경

- **유니버스 스크리닝**: `update_universe.py`에 레버리지/인버스 ETF 제외 로직 추가
- **필터링 순서**: 기존 필터링 후 레버리지/인버스 ETF 제외 단계 추가

## [2.9.0] - 2025-09-03

### 추가

- **진정한 전체 시장 스캔**: Finviz.com 기반 실시간 유니버스 스크리닝 시스템
- **2단계 추진 로켓 방식**: 사전 필터링 + 온디맨드 FMS 스캔으로 성능 최적화
- **유니버스 스크리닝 스크립트**: `update_universe.py`로 매일 업데이트되는 유망주 목록 생성
- **동적 스크리닝**: 가격 $5+, 거래량 200K+, 1개월 수익률 0%+ 등 다중 필터 적용
- **대규모 데이터 처리**: 8,000+ 종목에서 유망주 후보군 자동 발굴

### 수정

- **스캔 기능 전면 개편**: 하드코딩된 150개 종목에서 실제 전체 시장 스캔으로 전환
- **UI/UX 개선**: "유망주 유니버스 스캔" 명칭으로 기능 명확화
- **캐싱 최적화**: 1시간 캐시로 반복적인 파일 I/O 및 계산 방지
- **에러 처리 강화**: 파일 없음, 네트워크 오류 등 다양한 예외 상황 대응

### 개선

- **성능 최적화**: 사전 스크리닝으로 API 호출 횟수 대폭 감소
- **사용자 경험**: 명확한 안내 문구와 도움말 추가
- **코드 정리**: 불필요한 함수 제거 및 모듈화 개선
- **의존성 관리**: finvizfinance 라이브러리 추가

### 변경

- **아키텍처**: 단일 스캔에서 2단계 분리 스캔으로 전환
- **데이터 소스**: 하드코딩된 목록에서 실시간 Finviz 스크리닝으로 변경
- **파일 구조**: `screened_universe.csv` 추가, `update_universe.py` 스크립트 추가

## [2.8.0] - 2025-09-03

### 추가

- **관심종목 영구 저장 기능**: `watchlist.csv` 파일을 통한 관심종목 영구 저장
- **실시간 포괄적 종목 탐색**: S&P 500, 주요 ETF, 테마 ETF 등 150+ 종목을 실시간으로 스캔
- **중복 제거 최적화**: VOO와 SPY 같은 유사한 ETF들 중 대표적인 것만 선택하여 효율성 극대화
- **진부한 종목 자동 편출 제안**: FMS 하위 25% 종목 자동 식별 및 제거 제안
- **동적 포트폴리오 관리**: 실시간 관심종목 추가/삭제 기능
- **관심종목 관리 UI**: 사이드바에 직관적인 관심종목 관리 인터페이스
- **배치 처리 시스템**: 대량 종목 스캔을 위한 효율적인 배치 처리

### 수정

- **신규종목 탐색 버그 수정**: 일련번호 대신 실제 티커명 표시 문제 해결
- **관심종목 재평가 버그 수정**: 삭제 버튼 클릭 시 expander가 닫히는 문제 해결
- **대시보드 자동 업데이트**: 관심종목 추가/삭제 후 대시보드 즉시 반영
- **UI 개선**: 성공 메시지 제거로 깔끔한 사용자 경험 제공

### 개선

- **모듈화**: `watchlist_utils.py`로 관심종목 관리 로직 분리
- **함수 정의 순서 최적화**: 의존성 순서에 따른 함수 재정렬로 안정성 향상
- **사용자 경험**: 직관적인 UI/UX로 관심종목 관리 간소화
- **성능 최적화**: API 제한을 고려한 배치 처리 및 캐싱
- **에러 처리**: 강화된 예외 처리 및 사용자 친화적 오류 메시지
- **코드 정리**: 중복 함수 제거 및 불필요한 파일 정리

### 변경

- **아키텍처**: 하드코딩된 종목 리스트에서 실시간 포괄적 종목 탐색 시스템으로 전환
- **버전**: v2.7에서 v2.8로 업그레이드
- **기능 확장**: 단순 모니터링 도구에서 탐색 엔진으로 진화
- **파일 구조**: `us_etf_list.csv` 제거, 실시간 종목 목록 생성으로 대체

### 제거

- **고정 ETF 목록**: `us_etf_list.csv` 파일 제거
- **중복 함수**: 중복된 함수 정의들 제거
- **임시 파일**: `__pycache__` 디렉토리 및 임시 파일들 정리

## [2.7.0] - 2024-09-02

### 추가

- FMS(Fast Momentum Score) 설명 박스 추가
- 애니메이션 모드 선택 시 꼬리 길이 자동 조정 (5일)
- 애니메이션 자동 재생 기능
- 꼬리 길이 기본값을 0으로 변경
- 차트 기간 기본값을 3M으로 변경

### 개선

- 수익률-변동성 이동맵의 꼬리 효과 개선
- 정적 모드와 애니메이션 모드 분리
- 연한→진한 그라데이션 꼬리 표시
- 꼬리 길이 설정 옵션 (0~10일)
- 애니메이션 모드에서 프레임마다 꼬리 동시 갱신
- 이동맵 시각화 성능 최적화
- 꼬리 세그먼트 렌더링 개선
- 애니메이션 프레임 처리 최적화

### 변경

- 꼬리 표시 방식 변경 (단색 → 그라데이션)
- 애니메이션 컨트롤 UI 개선
- 꼬리 길이 > 0일 때 과거 시점들(1M ago, Yesterday) 숨김
- 상단 KPI 섹션 제거로 UI 간소화
- 세부보기 차트 범례를 하단 중앙으로 이동

## [2.6.0] - 2024-08-XX

### 추가

- FMS(Fast Momentum Score) 기반 모멘텀 스코어링 시스템
- 다국가 시장 통합 분석 (미국, 한국, 일본)
- KRW 환산 가격 비교 기능
- 1일/5일 가속도 변화량 추적
- 모멘텀 상태 배지 시스템

### 개선

- 데이터 다운로드 성능 최적화
- 캐싱 시스템 개선
- 에러 처리 강화

### 변경

- 기존 단순 수익률 기반에서 FMS 기반으로 전환
- UI 레이아웃 개선

## [2.5.0] - 2024-07-XX

### 추가

- 수익률-변동성 이동맵 기본 기능
- 3개 시점 비교 (1개월 전, 어제, 오늘)
- 이동 경로 시각화

### 개선

- 차트 렌더링 성능 개선
- 데이터 정렬 알고리즘 최적화

## [2.0.0] - 2024-06-XX

### 추가

- Streamlit 기반 웹 애플리케이션으로 전환
- Plotly 기반 인터랙티브 차트
- 실시간 데이터 업데이트
- 다국가 시장 지원

### 변경

- 기존 데스크톱 애플리케이션에서 웹 애플리케이션으로 전환
- UI/UX 완전 재설계

### 제거

- 기존 데스크톱 GUI 컴포넌트

## [1.0.0] - 2024-05-XX

### 추가

- 초기 버전 릴리스
- 기본 모멘텀 분석 기능
- 한국 시장 중심 분석
- 단순 차트 표시

---

## 버전 규칙

### Major (X.0.0)

- 호환성을 깨는 변경사항
- 새로운 아키텍처 도입
- 주요 기능의 완전한 재설계

### Minor (X.Y.0)

- 새로운 기능 추가
- 기존 기능의 개선
- 새로운 시장/지표 추가

### Patch (X.Y.Z)

- 버그 수정
- 성능 개선
- 문서 업데이트
- UI/UX 미세 조정

## 기여자

이 프로젝트에 기여해주신 모든 분들께 감사드립니다:

- [기여자 목록은 GitHub에서 자동으로 관리됩니다]

## 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다. 자세한 내용은 [LICENSE](LICENSE) 파일을 참조하세요.
