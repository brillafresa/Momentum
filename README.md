# KRW Momentum Radar

⚡ **KRW Momentum Radar v3.6.0**는 다국가 주식 시장의 모멘텀을 실시간으로 분석하고 시각화하는 Streamlit 웹 애플리케이션입니다. 이제 단순한 모니터링 도구를 넘어서 **진정한 의미의 전체 시장 탐색 엔진**으로 진화했습니다.

## 🌟 주요 기능

### 📊 가속 보드

- FMS(Fast Momentum Score) 기반 실시간 모멘텀 분석
- **안정 성장형 FMS 전략**: 추세의 지속성과 안정성을 중시하는 통일된 모멘텀 분석
- 1일/5일 가속도 변화량 추적
- 상위 N개 종목의 모멘텀 랭킹

### 📈 비교 차트

- 다국가 종목들의 KRW 환산 가격 비교
- 로그/선형 스케일 선택 가능
- 기간별 성과 비교 (3M, 6M, 1Y, 2Y, 5Y)

### 🎯 수익률-변동성 이동맵

- **정적 모드**: 1개월 전 → 어제 → 오늘의 이동 경로 시각화
- **애니메이션 모드**: 최근 10일/20일의 실시간 이동 추적 (종목명 표시)
- **로그 스케일**: 세로축(수익성) 로그 스케일로 넓은 범위의 수익률 비교
- 꼬리 효과로 과거 경로 추적 가능

### 📋 상세 분석

- 개별 종목의 EMA(20, 50, 200) 분석
- 최대 낙폭(Drawdown) 추적
- 모멘텀 상태 배지 시스템
- **종목 네비게이션**: 정렬된 순서로 이전/다음 종목 이동 및 맨 끝으로 이동

### 📁 관심종목 관리

- **파일 업로드/다운로드**: CSV 파일로 관심종목 백업 및 복원
- **수동 관리**: 개별 종목 추가/삭제
- **FMS 기반 재평가**: 저성과 종목 자동 식별 및 제거 제안
- **실시간 동기화**: 파일 변경 시 자동 새로고침

### 🚀 신규 종목 탐색

- **유니버스 파일 관리**: 스크린된 유니버스 파일 업로드/다운로드
- **실시간 진행률 표시**: 유니버스 업데이트 및 FMS 스캔 과정의 실시간 진행률 표시
- **FMS 스캔**: 사전 필터링된 목록에서 모멘텀 상위 종목 탐색
- **스캔 결과 영구 저장**: FMS 2.0 이상 종목을 자동으로 파일에 저장하여 세션 간 유지
- **동적 후보 리스트**: 종목 추가 시 후순위 종목이 자동으로 후보로 올라오는 스마트 관리
- **페이징 시스템**: 5~30개 선택 가능한 페이지당 표시 종목 수로 대량 후보 효율적 탐색
- **FMS 임계값 필터링**: 슬라이더로 원하는 FMS 점수 이상의 종목만 표시
- **저장된 결과 로드**: 이전 스캔 결과를 언제든지 불러와서 계속 탐색 가능
- **원클릭 추가**: 발견된 종목을 관심종목에 즉시 추가 (UI 리로드 없이)
- **[신규] 배치 스캔 결과 UI**: 사이드바의 "📦 배치 스캔 관리"에서 배치 결과를 FMS 순으로 확인하고 원클릭으로 관심종목 추가

### 🚀 진정한 전체 시장 탐색 엔진 (NEW!)

- **실시간 유니버스 스크리닝**: Finviz.com 기반으로 미국 전체 시장(8,000+ 종목)에서 유망주 발굴
- **2단계 추진 로켓 방식**: 사전 필터링 + 온디맨드 FMS 스캔으로 성능 최적화
- **동적 스크리닝**: 가격 $5+, 거래량 200K+, 1개월 수익률 0%+ 등 다중 필터 자동 적용
- **레버리지/인버스 ETF 제외**: 모멘텀의 본질을 흐리는 레버리지형 ETF 자동 제외
- **FMS 기반 랭킹**: 강력한 모멘텀을 가진 신규 종목 자동 발견
- **원클릭 추가**: 발견된 종목을 관심종목에 즉시 추가

### 📋 동적 관심종목 관리 (NEW!)

- **영구 저장**: 관심종목이 세션 종료 후에도 유지
- **실시간 관리**: 직관적인 UI로 관심종목 추가/삭제
- **자동 편출 제안**: 저성과 종목 자동 식별 및 제거 제안

## 🚀 빠른 시작

### 로컬 실행

Windows (권장)

```bat
:: 저장소 클론 후 프로젝트 폴더에서
start.bat
```

일반(수동) 방법

```bash
# 저장소 클론
git clone <repository-url>
cd Momentum

# 가상환경 생성/활성화 및 의존성 설치 (Python 3.11 권장)
py -3.11 -m venv venv || python -m venv venv
./venv/Scripts/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt

# 애플리케이션 실행 (포트 8501 사용 권장)
streamlit run app.py --server.port 8501
```

### Streamlit Cloud 배포

1. GitHub에 저장소 푸시
2. [Streamlit Cloud](https://share.streamlit.io)에서 새 앱 생성
3. 저장소 연결 및 `app.py` 파일 지정
4. 자동 배포 완료!

## 📦 포함된 시장

### 🇺🇸 미국 (USD)

- 주요 ETF: SPY, QQQ, VOO, DIA
- 섹터 ETF: XLK, XLF, XLV, SOXX
- 테마 ETF: ICLN, BOTZ, IBB
- 개별주: NVDA, GOOGL

### 🇰🇷 한국 (KRW)

- 대형주: 삼성전자(005930.KS)
- ETF: KODEX, TIGER, ARIRANG 시리즈

### 🇯🇵 일본 (JPY)

- 개별주: 2563.T

## 🔧 설정 옵션

### 차트 기간

- 3M, 6M, 1Y, 2Y, 5Y 선택 가능

### 정렬 기준

- **ΔFMS(1D)**: 1일 가속도 변화
- **ΔFMS(5D)**: 5일 가속도 변화
- **FMS(현재)**: 현재 모멘텀 점수
- **1M 수익률**: 1개월 수익률

### 표시 옵션

- Top N: 5~60개 종목 선택
- 로그 스케일: 비교 차트용
- 꼬리 길이: 0~10일 이동 경로

## 🧰 배치 스캔 사용 (요약)

- 배치 스캔은 정확도 중심의 오프라인 계산입니다. 실행/상태 확인은 앱 사이드바의 "📦 배치 스캔 관리"에서 가능합니다.
- Windows 작업 스케줄러 설정 방법은 `README_BATCH.md`를 참조하세요.
- 앱/배치 모두 동일한 단일 FMS/필터 로직(`analysis_utils.py`)을 사용합니다.
- yfinance 레이트리밋 발생 시 지수 백오프로 최대 10회 재시도하며, 상장폐지/데이터 없음은 건너뜁니다.
- **다국가 스캔**: USA(Finviz 스크리닝) + Korea(KOSPI 200 + KOSDAQ 150, 총 350개) 통합 스캔 지원

## 📊 지표 설명

### FMS (Fast Momentum Score)

#### 안정 성장형 전략

```
FMS = 0.4×Z(1M수익률) + 0.3×Z(3M수익률) + 0.2×Z(EMA50상대위치)
      - 0.4×Z(20일변동성)
```

**특징:**

- **추세 지속성**: 1M + 3M 수익률로 단기/중기 모멘텀 종합 평가
- **안정성 중시**: 변동성 페널티 강화 (-0.4)로 급등 종목 필터링
- **EMA 상대위치**: 50일 지수이동평균 대비 현재가 위치로 추세 강도 측정
- **거래 적합성 필터**: True Range 기반 부적합한 거래 패턴을 가진 종목 자동 실격 (치명적 변동성 30% 초과, 반복적 하방리스크 감지)
- **목표**: 꾸준하고 지속 가능한 상승 추세 종목 발굴

### 주요 지표

- **R_1M**: 1개월 수익률
- **R_3M**: 3개월 수익률
- **AboveEMA50**: EMA50 대비 현재가 위치
- **Vol20**: 20일 변동성 (연율화)

## 🛠️ 기술 스택

- **Frontend**: Streamlit
- **Data**: yfinance (Yahoo Finance API), finvizfinance (Finviz 스크리닝)
- **Visualization**: Plotly
- **Data Processing**: Pandas, NumPy
- **Timezone**: pytz (KST 기준)

## 📝 버전 히스토리

### v3.6.0 (현재)

- **한국 종목명 파일 기반 관리**: `korean_universe.csv`에 `Name` 컬럼 추가로 한국 종목명 직접 관리
- **종목명 영구 캐시 시스템**: `symbol_names_cache.json` 파일 기반으로 비한국 종목명 캐시 저장
- **한국 종목명 처리 효율화**: 한국 종목(.KS)은 yfinance API 호출 없이 파일에서 직접 읽어오도록 개선
- **한국 종목명 정확도 향상**: yfinance의 이상한 문자열 대신 파일에 입력한 정확한 종목명 사용

### v3.5.0

- **수익성-변동성 그래프 로그 스케일**: 세로축에 로그 스케일 적용으로 넓은 범위의 수익률 비교 용이
- **애니메이션 모드 종목명 표시**: 애니메이션 중에도 종목명 표시로 가독성 향상
- **버그 수정**: 데이터 부족 시 발생할 수 있는 오류 방지

### v3.4.0

- **세부보기 종목 네비게이션 기능**: 정렬된 순서로 종목 탐색 (이전/다음/맨 끝 이동)
- 코드 정리 및 파일 정리

### v3.3.0

- **배치 스캔 결과 UI 복원**: 배치 스캔 결과를 UI에서 확인하고 관심종목에 추가하는 기능 추가
- FMS 순 정렬 및 페이징으로 대량 결과 효율적 탐색
- 원클릭 관심종목 추가로 빠른 포트폴리오 구성

### v3.2.0

- **FMS 계산 Z-score 왜곡 문제 해결**: -999 패널티 종목을 Z-score 계산에서 제외하여 정확도 향상
- **배치 간 API 제한 방지**: chunk 간 0.1초 대기 추가로 yfinance 레이트리밋 대응 강화
- **Watchlist 실격 필터링**: 배치 스캔 시 참조 데이터 품질 향상
- **아키텍처 단순화**: 인터랙티브 스캔 제거, 배치 스캔 전용 시스템으로 전환
- **코드 중복 제거**: `run_scan_batch.py`에서 중앙화된 `analysis_utils.py` 로직 사용
- **FMS 임계값 조정**: 신규 탐색 시 2.0→0.0으로 조정하여 더 많은 종목 포함
- **다국가 통합 스캔**: 미국(Finviz) + 한국(KOSPI200/KOSDAQ150) 유니버스 병합으로 글로벌 모멘텀 종목 탐색

### v3.0.8

- **치명적 변동성 필터 로직 개선**: True Range 기반 계산으로 가격 갭 반영
  - 기존: `(당일 고가 - 당일 저가) / 전일 종가` (일중 변동성만 측정)
  - 신규: `max(고가-저가, |고가-전일종가|, |저가-전일종가|) / 전일종가` (가격 갭 포함)
  - 주말/휴일 등 비거래일에 발생하는 큰 폭의 가격 변동(갭 상승/하락) 정확 감지
  - 업계 표준 True Range 방식 적용으로 필터링 정확도 대폭 향상
- **필터링 임계값 완화**: 치명적 변동성 필터를 15%에서 30%로 완화하여 더 많은 종목이 통과할 수 있도록 개선
- **필터링 상태 표시**: 모멘텀 테이블에 Filter_Status 컬럼 추가로 실격 이유를 명확히 표시

### v3.0.7

- **FMS 계산 로직 통일**: 변동성 가속도 제거로 일관된 FMS 공식 적용
- **거래 적합성 필터**: True Range 기반 치명적 변동성 및 반복적 하방리스크 감지로 부적합 종목 자동 실격
- **동적 컬럼 재정렬**: FMS 전략에 맞춰 결과 테이블 컬럼 순서 자동 조정
- **문서 일관성**: config.py, README.md의 FMS 설명 통일

### v3.0.6

- **FMS 계산 로직 일관성 개선**: Z-score 정규화 기준을 관심종목 집합으로 통일
- **참조 데이터 시스템 도입**: 유니버스 스캔과 관심종목에서 동일한 FMS 값 계산
- **신뢰성 향상**: FMS 값 불일치 문제 해결로 사용자 경험 개선
- **코드 정리**: 사용하지 않는 함수 제거 및 최적화

### v3.0.5

- **FMS 전략 단일화**: Standard 전략 제거, 안정 성장형 전략으로 통일
- **FMS 계산 로직 일관성**: 스캔 결과와 관심종목 표시에서 동일한 FMS 값 계산
- **UI 단순화**: FMS 전략 선택 UI 제거, 도구 및 도움말에만 수식 설명 표시
- **페이징 버튼 중복 방지**: 연속 클릭 시 화살표 버튼 중복 생성 버그 수정
- **캐시 초기화 메시지 개선**: 불필요한 "Rerun 클릭" 메시지 제거

### v3.0.4

- **신규 FMS 전략 '안정 성장형' 추가**: 추세의 지속성과 안정성을 중시하는 새로운 FMS 계산 방식
- **3M수익률 및 변동성 가속도 지표**: 중기 모멘텀 평가 및 급등 패턴 감지
- **FMS 전략 선택 UI**: 좌측 사이드바에서 Standard/Stable Growth 전략 선택 가능
- **이벤트성 급등주 필터링**: 변동성 가속도로 수직 폭등 종목 자동 제거

### v3.0.3

- **모듈화된 유니버스 관리**: `universe_utils.py`로 유니버스 관리 로직 분리
- **실시간 진행률 표시**: 유니버스 업데이트 및 FMS 스캔 과정의 실시간 진행률 표시
- **유니버스 파일 업로드**: CSV 파일을 통한 유니버스 교체 기능 복구
- **성능 최적화**: 중복 표시 제거 및 사용자 경험 개선

### v2.9.1

- **레버리지/인버스 ETF 제외**: 모멘텀의 본질을 흐리는 레버리지형 ETF 자동 제외
- **다양한 레버리지 패턴 인식**: 2X, 3X, 2배, 3배, Inverse, Short, Bear 등 다양한 패턴 지원
- **모멘텀 분석 정확도 향상**: 순수한 모멘텀 종목만 선별하여 분석 품질 향상

### v2.9

- **진정한 전체 시장 스캔**: Finviz.com 기반 실시간 유니버스 스크리닝 시스템
- **2단계 추진 로켓 방식**: 사전 필터링 + 온디맨드 FMS 스캔으로 성능 최적화
- **유니버스 스크리닝 스크립트**: `update_universe.py`로 매일 업데이트되는 유망주 목록 생성
- **동적 스크리닝**: 가격 $5+, 거래량 200K+, 1개월 수익률 0%+ 등 다중 필터 적용
- **대규모 데이터 처리**: 8,000+ 종목에서 유망주 후보군 자동 발굴

### v2.8

- **관심종목 영구 저장**: CSV 파일을 통한 관심종목 영구 저장
- **관심종목 관리 UI**: 사이드바에 직관적인 관심종목 관리 인터페이스
- **진부한 종목 자동 편출**: FMS 기반 저성과 종목 제거 제안
- **동적 포트폴리오 관리**: 실시간 관심종목 추가/삭제
- **모듈화**: 관심종목 관리 로직을 별도 모듈로 분리
- **함수 정의 순서 최적화**: 의존성 순서에 따른 함수 재정렬로 안정성 향상

### v2.7

- FMS 설명 박스 추가로 사용자 이해도 향상
- 애니메이션 자동 재생 및 꼬리 길이 자동 조정
- 시각적 개선 (과거 시점과 꼬리 중복 제거)
- UI 간소화 (상단 KPI 제거, 기본값 최적화)

### v2.6

- FMS 기반 모멘텀 스코어링
- 다국가 시장 통합 분석
- KRW 환산 가격 비교

## 🤝 기여하기

1. Fork the Project
2. Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3. Commit your Changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the Branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## 📄 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다. 자세한 내용은 `LICENSE` 파일을 참조하세요.

## ⚠️ 면책 조항

이 도구는 교육 및 연구 목적으로만 제공됩니다. 투자 결정에 사용하기 전에 반드시 전문가의 조언을 구하시기 바랍니다. 과거 성과가 미래 결과를 보장하지 않습니다.

## 📞 문의

프로젝트에 대한 질문이나 제안사항이 있으시면 이슈를 생성해 주세요.

---

**⚡ KRW Momentum Radar** - 모멘텀의 힘을 시각화하세요!
